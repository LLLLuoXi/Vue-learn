<!--
 * @Author: luoxi
 * @LastEditTime: 2022-04-26 22:44:25
 * @LastEditors: your name
 * @Description: 
-->
- [ğŸ—ï¸ åˆ›å»ºvueå®ä¾‹æµç¨‹](#ï¸-åˆ›å»ºvueå®ä¾‹æµç¨‹)
- [ğŸ”ƒ é‡æ¸²æŸ“æµç¨‹](#-é‡æ¸²æŸ“æµç¨‹)

new Vueä¹‹åï¼Œå‘ç”Ÿçš„æµç¨‹ï¼Œä»¥åŠæ•°æ®æ”¹å˜ä¹‹åå‘ç”Ÿçš„æµç¨‹ã€‚

## ğŸ—ï¸ åˆ›å»ºvueå®ä¾‹æµç¨‹
åˆ›å»ºvueå®ä¾‹å’Œåˆ›å»ºç»„ä»¶çš„æµç¨‹åŸºæœ¬ä¸€è‡´ã€‚
1. é¦–å…ˆåšä¸€äº›åˆå§‹åŒ–çš„æ“ä½œï¼Œä¸»è¦æ˜¯è®¾ç½®ä¸€äº›ç§æœ‰å±æ€§åˆ°å®ä¾‹ä¸­ï¼Œæ¯”å¦‚ä»¥`_` `$`å¼€å¤´çš„å˜é‡ã€‚
2. **è¿è¡Œç”Ÿå‘½å‘¨æœŸå‡½æ•°`beforeCreate`ã€‚**
3. è¿›å…¥åˆ°æ³¨å…¥æµç¨‹ï¼šå¤„ç†å±æ€§ã€`computed`,`methods`ã€`data`,`provide`,`inject`,æœ€åä½¿ç”¨ä»£ç†æŒ‚è½½åˆ°å®ä¾‹ä¸­ã€‚
ä¼ªä»£ç ï¼š
```js
function Vue(options) {
  var data = options.data()
  // å˜æˆå“åº”å¼æ•°æ®,å¯¹è±¡ä¼šé€’å½’å¤„ç†ï¼Œæ•°ç»„çš„è¯è¦æ”¹å˜å®ƒçš„åŸå‹é“¾
  observe(data)
  // å®ç° this.a æŠŠå±æ€§æŒ‚è½½åˆ°å®ä¾‹ä¸­
  Object.defineProperty(this, 'a', {
    get() {
      return data.a
    },
    set(val) {
      data.a = val
    }
  })
  // å¯¹computedä¹Ÿåšç±»ä¼¼çš„å¤„ç†ï¼Œå±æ€§æŒ‚è½½åˆ°_props,ä¹Ÿæ˜¯å“åº”å¼å¯¹è±¡ï¼Œ
  // å¯¹methodçš„å¤„ç† æ˜¯method æŒ‡å‘this
  var methods = options.method
  Object.entries(methods).forEach(([methodName, fn]) => {
    this[methodName] = fn.bind(this)
  })
}
```
4. **è¿è¡Œç”Ÿå‘½å‘¨æœŸå‹¾å­å‡½æ•°``created``**
5. ç”Ÿæˆ``render``å‡½æ•°ï¼šå¦‚æœæœ‰é…ç½®ï¼Œç›´æ¥ä½¿ç”¨é…ç½®çš„``render``ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä½¿ç”¨è¿è¡Œæ—¶ç¼–è¯‘å™¨ï¼ŒæŠŠæ¨¡æ¿ç¼–è¯‘æˆ``render``ã€‚
6.  **è¿è¡Œç”Ÿå‘½å‘¨æœŸå‹¾å­å‡½æ•°``beforeMount``**
7.  è¿›å…¥æ¸²æŸ“æµç¨‹ã€‚åˆ›å»ºä¸€ä¸ª``watcher``,ä¼ å…¥ä¸€ä¸ªå‡½æ•°``updateComponent``,è¯¥å‡½æ•°ä¼šè¿è¡Œ``render``ï¼ŒæŠŠå¾—åˆ°çš„vnodeåœ¨ä¼ å…¥``_update``å‡½æ•°æ‰§è¡Œã€‚
    - åœ¨æ‰§è¡Œ``render``å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæ”¶é›†æ‰€æœ‰ä¾èµ–ï¼Œå°†æ¥ä¾èµ–å˜åŒ–çš„æ—¶å€™ä¼šé‡æ–°è¿è¡Œ``updateComponent``å‡½æ•°
    - åœ¨æ‰§è¡Œ``_update``å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šè§¦å‘patchå‡½æ•°è¿›è¡Œæ–°æ—§ä¸¤æ£µæ ‘å¯¹æ¯”ï¼Œ``_vnode = vnode``è·å¾—æ–°çš„è™šæ‹ŸèŠ‚ç‚¹ï¼Œç”±äºç›®å‰æ²¡æœ‰æ—§æ ‘ï¼Œæ‰€ä»¥ç›´æ¥ä¸ºå½“å‰çš„è™šæ‹Ÿdomæ ‘çš„æ¯ä¸€ä¸ªæ™®é€šèŠ‚ç‚¹ç”Ÿæˆ``elm``å±æ€§ï¼Œå°±æ˜¯çœŸå®domã€‚
    - å¦‚æœé‡åˆ°åˆ›å»ºä¸€ä¸ªç»„ä»¶çš„vnode,åˆ™ä¼šè¿›å…¥åˆ°ç»„ä»¶å®ä¾‹åŒ–æµç¨‹ï¼Œå’Œåˆ›å»ºvueå®ä¾‹æµç¨‹åŸºæœ¬ç›¸åŒï¼Œæœ€ç»ˆä¼šæŠŠåˆ›å»ºå¥½çš„ç»„ä»¶å®ä¾‹æŒ‚è½½åˆ°vnodeçš„``componentInstance``å±æ€§ä¸­ï¼Œå°†æ¥å¤ç”¨ã€‚

```js
function Vue(options) {
  // other code...
  var updateComponent = () => {
    // æ‰§è¡Œ_updateè¿‡ç¨‹ä¸­ï¼Œè§¦å‘patchå‡½æ•°
    this._update(this._render())
  }
  new Wathcer(updateComponent)
}
```
8.  **è¿è¡Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°``mounted``**ã€‚

æ¯”å¦‚Appç»„ä»¶ä¸­æœ‰Aç»„ä»¶ï¼ŒAç»„ä»¶é‡Œæœ‰Bç»„ä»¶ã€‚
ç›‘å¬ä»–ä»¬æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œé¦–æ¬¡æ¸²æŸ“çš„ç»“æœä¼šæ˜¯è¿™æ ·ï¼š
```js
vueå®ä¾‹ beforeCreate
vueå®ä¾‹ created
vueå®ä¾‹ beforeMount
App beforeCreate
App created
App beforeMount
A beforeCreate
A created
A beforeMount
B beforeCreate
B created
B beforeMount
B mounted
A mounted
App mounted
vueå®ä¾‹ mounted
```
å½“vueå®ä¾‹èµ°åˆ°``beforeMount``é˜¶æ®µæ¸²æŸ“Appçš„æ—¶å€™ï¼Œä¼šåœ¨``updateComponent``ä¸­ç­‰å¾…ï¼Œè¿›å…¥Appç»„ä»¶çš„å®ä¾‹è¯ï¼Œè¿›å…¥Appçš„ç”Ÿå‘½å‘¨æœŸï¼Œç­‰Appä»¥åŠå­ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸèµ°å®Œï¼Œæ‰å®Œæˆè‡ªèº«çš„æ¸²æŸ“æµç¨‹ã€‚


## ğŸ”ƒ é‡æ¸²æŸ“æµç¨‹
1. æ•°æ®å˜åŒ–åï¼Œæ‰€æœ‰ä¾èµ–æ•°æ®çš„``Watcher``ä¼šé‡æ–°è¿è¡Œï¼Œè¿™é‡Œä»…ä»…è€ƒè™‘``updateComponent``çš„``Watcher``ã€‚
2. ä¸ºäº†é¿å…å¤šä¸ªä¾èµ–æ•°æ®åŒäº‹å‘ç”Ÿæ”¹å˜åèƒŒå¤šæ¬¡æ‰§è¡Œï¼Œ``Watcher``ä¼šè¢«è°ƒåº¦å™¨æ”¾åˆ°``nextTick``ä¸­è¿è¡Œï¼Œä¹Ÿå°±æ˜¯å¾®é˜Ÿåˆ—ä¸­ï¼Œ
3. **è¿è¡Œç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°``beforeUpdate``**ã€‚
4. ``updateComponent``å‡½æ•°é‡æ–°æ‰§è¡Œã€‚
   - è¿è¡Œ``render``å‡½æ•°çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå»æ‰ä¹‹å‰çš„ä¾èµ–ï¼Œé‡æ–°æ”¶é›†æ‰€æœ‰ä¾èµ–ï¼Œå°†æ¥ä¾èµ–å˜åŒ–çš„æ—¶å€™ä¼šé‡æ–°è¿è¡Œ``updateComponent``ï¼Œ
   - åœ¨æ‰§è¡Œ``_update``ä¸­ï¼Œè§¦å‘``patch``å‡½æ•°ï¼Œæ–°æ—§ä¸¤æ£µæ ‘è¿›è¡Œå¯¹æ¯”ï¼Œä»¥å°½é‡æœ€å°é‡çš„æ›´æ–°åŸåˆ™å¤„ç†ï¼Œæ™®é€šçš„htmlèŠ‚ç‚¹çš„å¯¹æ¯”ä¼šå¯¼è‡´çœŸå®èŠ‚ç‚¹è¢«åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€æ›´æ–°ï¼Œç»„ä»¶çš„èŠ‚ç‚¹çš„å¯¹æ¯”å¯¼è‡´ç»„ä»¶è¢«åˆ›å»ºã€åˆ é™¤ã€ç§»åŠ¨ã€æ›´æ–°ã€‚
   - å½“æ–°ç»„å»ºéœ€è¦åˆ›å»ºæ—¶ï¼Œè¿›å…¥ç»„ä»¶å®ä¾‹åŒ–æµç¨‹ã€‚
   - å½“æ—§ç»„ä»¶éœ€è¦åˆ é™¤æ—¶ï¼Œä¼šè°ƒç”¨æ—§ç»„ä»¶çš„``$destroy``åˆ é™¤ç»„ä»¶ï¼Œé¦–å…ˆä¼šè§¦å‘**ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°``beforeDestory``**,ç„¶åé€’å½’è°ƒç”¨å­ç»„ä»¶çš„``$destroy``ï¼Œç„¶åè§¦å‘è‡ªèº«çš„**ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°``destoryed``**,
   - å½“ç»„ä»¶å±æ€§æ›´æ–°æ—¶ï¼Œç›¸å½“äºç»„ä»¶çš„``updateComponent``é‡æ–°è¿è¡Œï¼Œé‡æ–°è¿›å…¥é‡æ¸²æŸ“æµç¨‹ã€‚

5. è¿è¡Œ**ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°``updated``**ã€‚

æ¯”å¦‚Appç»„ä»¶é€šè¿‡``props``æŠŠ``count``ä¼ ç»™Aç»„ä»¶ï¼ŒAç»„ä»¶åˆæŠŠ``count``ä¼ ç»™Bç»„ä»¶ï¼ŒBç»„ä»¶åœ¨ç»„ä»¶å†…ç”¨åˆ°è¿™ä¸ª``count``ï¼Œå½“``count``å˜åŒ–æ—¶ã€‚
ç›‘å¬ä»–ä»¬æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œé‡æ¸²æŸ“çš„ç»“æœä¼šæ˜¯è¿™æ ·ï¼š
```js
App beforeUpdate
A beforeUpdate
B beforeUpdate
B updated
A updated
App updated
```

Appç»„ä»¶é€šè¿‡``v-if``æŠŠAç»„ä»¶å’ŒBç»„ä»¶éƒ½éšè—æ—¶
ç›‘å¬ä»–ä»¬æ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œé‡æ¸²æŸ“çš„ç»“æœä¼šæ˜¯è¿™æ ·ï¼š
```js
App beforeUpdate
A beforeDestroy
B beforeDestroy
B destroyed
A destroyed
App updated
```
[å›¾è§£](https://cn.vuejs.org/v2/guide/instance.html#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%9B%BE%E7%A4%BA)


